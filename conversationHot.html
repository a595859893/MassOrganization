<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>讨论区</title>
    <meta name="viewport"
          content="width=375,initial-scale=0.84,user-scalable=0"/>
    <link rel="stylesheet" href="http://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">
    <link rel="stylesheet" href="css.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css">
    <style type="text/css">
        *{
            margin: 0;
            padding: 0;
        }

        .tlym{
            background-color: #ffffff;
        }
        .tlqbt1{
            position: relative;
            height: 8em;
        }
        .tlqbt{
            width: 100%;
            margin-top: 3em;
            margin-bottom: 0;
            font-size: 1.1em;
            font-weight: 900;
            display: inline-block;
            text-align: center;
        }
        .tlsj{
            position: absolute;
            right: 0;
            display:block;
            margin-top: 0;
            margin-bottom: 1em;
            color: #bfbfbf;
        }
        .tlqfg{
            width: 100%;
            display: inline-block;
            height: 1.8em;
            background-color: #f0ebf1;
            text-align: right;
        }
        .tlsxtb {
            width: 1.6em;
            height: 1.6em;
            background-color: green;
            display: inline-block;
        }
        .tlltk{
            position: relative;
            display: inline-block;
            width: 100%;
            height: 6em;
        }

        .tllogo {
            float: left;
            display: inline-block;
            margin: 1em 1em;
            width: 4em;
            height: 4em;
            border-radius: 50%;
            background-color: #615f62;
            color: #fefcff;
        }
        .tlkxx{
            float: left;
            width:73%;
            height: 6em;
            display: inline-block;
            border-bottom: solid 0.01em #e0e0e0;
        }
        .tlkxxsj{
            display: block;
            height: 1.3em;
            line-height: 2.3em;
            width: 100%;
            color: #bfbfbf;
            margin-top: 0.8em;

        }
        .tlkxxnr{
            display: block;
            line-height: 3em;
            height: 3em;
        }
        .tldzpl {
            position: absolute;
            float: right;
            width: 6.7em;
            height: 1.3em;
            display: inline-block;
            bottom: 0.3em;
            right: 0;
            /*background-color: red;*/
        }

        .tltb {
            display: inline-block;
            width: 1.3em;
            height: 1.3em;
            /*background-color: green;*/
        }
        .heisez {
            color: #474547;
        }
        /*/-------------------------------------------------*/
        .tlhfnr {
            position: absolute;
            display: inline-block;
            margin-left: 4em;
        }


        .tlxjpl {
            position: relative;
            float: right;
            background-color: #eae7de;
            margin-top: 0.1em;
            margin-right: 0.5em;
            width: 1.3em;
            height: 1.3em;
            line-height: 1em;
            display: inline-block;
            border: solid;
            border-width: thin;
            border-color: #423d43;
            text-align: center;
            border-radius: 30%;
        }

        .tlhfyuan {
            background-color: #646265;
            width: 1.3em;
            height: 1.3em;
            line-height: 1.3em;
            text-align: center;
            border-radius: 0.65em;
            display: inline-block;
            color: #f6f6f6;
            left: 1em;
        }

        .tlsl {
            display: inline-block;
            top: -0.3em;
            line-height: 1.2em;
            font-size: 0.9em;
        }
        /*--------------------------------------------------*/

        .tlfenlei{
            text-align: right;
            background-color: #f7f7ff;
        }
        .tlxuanxiang2{
            font-size:  1.2em;
            line-height:0.9em;
            color: #adadad;
        }
        span.tlxuanzhong{
            color: #8ac148;
        }
        /*-------------------------------------*/
        .tlhf {
            background-color: #f0ebf1;
            overflow: hidden;
            border-radius: 2px;
            cursor: pointer;
            width: 100%;
            height: 1.6em;
            position: relative;
        }
        .tlhfyuan {
            position: absolute;
            background-color: #646265;
            width: 1.3em;
            height: 1.3em;
            line-height: 1.3em;
            text-align: center;
            border-radius: 50%;
            display: inline;
            left: 2em;
            color: #f6f6f6;
            margin-top: 0.1em;
        }

        .tlplkuang {
            width: 73%;
            height: 1.6em;
            position: absolute;
            display: inline-block;
            margin-left: 4em;
            margin-top: 0.2em;
            background-color: #f0eaf4;
            border: thin;
            font-size: 1em;
            font-family: "微软雅黑"
        }


        .tlxjpl {
            position: relative;
            float: right;
            background-color: #eae7de;
            margin-top: 0.1em;
            margin-right: 0.5em;
            width: 1.3em;
            height: 1.3em;
            line-height: 1em;
            display: inline-block;
            border: solid;
            border-width: thin;
            border-color: #423d43;
            text-align: center;
            border-radius: 30%;
        }

        .tlxjplfs {
            font-size: 1em;
            position: relative;
            float: right;
            background-color: #eae7de;
            margin-top: 0.1em;
            margin-right: 0.5em;
            width: 1.3em;
            height: 1.3em;
            line-height: 1em;
            display: inline-block;
            border-color: #423d43;
            text-align: center;
            border-radius: 30%;
        }

    </style>
</head>
<body>
<div class="tlym">
    <div class="tlqbt1"><span class="tlqbt">刚到中山大学你觉得最大的是什么</span><span class="tlsj">8月12日</span></div>
    <!----------------------------------------------筛选-------------------------------->
    <div id="tlfl"  class="tlfenlei buxianshi">
        <span class="tlxuanxiang2 ciji tlxuanzhong"  onclick="xuanxiang(event)">最热</span>
        <span class="tlxuanxiang2 ciji"  onclick="xuanxiang(event)">最新</span>
    </div>
    <script type="text/javascript">
        <!--顶部次次级选项卡-->
        function xuanxiang(evt, tabName) {
            var i,ciji;
            ciji = document.getElementsByClassName("ciji");
            for (i = 0; i < ciji.length; i++) {
                ciji[i].className = ciji[i].className.replace("tlxuanzhong", " ");
            }
            if (evt) evt.currentTarget.className += " tlxuanzhong";
        }
    </script>
    <!--------------------聊天框------------------------->
    <div id="content"></div>
    <div class="tlltk">
        <!--头像-->
            <img class="tllogo">
        <!--信息-->
            <span class="tlkxxsj">2017年8月12日</span>
            <span class="tlkxxnr">我觉得。。。。。。。。。</span>
            <!--点赞评论-->
                <div class="tldzpl ">
                    <i class="fa fa-thumbs-up tltb" style="color: #7e7e7e"></i>
                    <span class="tlsl heisez">11</span>&nbsp
                    <i class="fa fa-comment tltb"  style="color: #7e7e7e"></i>
                    <span class="tlsl heisez">0</span>
                </div>
        <!------------------------------------------------------------------>
        <div class="tlhf zhongyang">
            <img class="tlhfyuan">
            <p class="tlhfnr">单纯的回复，后面没有加号的</p>
        </div>
        <!-------------带新建的回复------------------>
        <div class="tlhf zhongyang">
            <img class="tlhfyuan">
            <p class="tlhfnr">最底下的一条评论</p>
            <span class="tlxjpl">+</span>
        </div>
        <!--新建评论窗口--->
        <div  class="tlhf zhongyang">
            <img class="tlhfyuan">
            <textarea type="text" style="color:#b8a4a4;" value="来发第一条评论吧" onfocus="if (value =='来发第一条评论吧'){value  =''}" onblur="if (value  ==''){value='来发第一条评论吧'}" class="tlplkuang" name="usrname">来发第一条评论吧</textarea>
            <div class="tlxjpl tlxjplfs">+</div>
        </div>
</div>

<script src="CommonJS.js"></script>
<script>

    init();

    function init() {
        var xmlhttp = GetXMLHTTPRequest();
        var content = {serverType: "Billboard", num: 10};
        xmlhttp.open("POST", "activity.php", true);
        xmlhttp.setRequestHeader("CONTENT-TYPE", "application/x-www-form-urlencoded");
        xmlhttp.send(toStr(content));
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var json = JSON.parse(xmlhttp.responseText);
                if (json.success)
                    dealContent(json);
                else
                    console.log(json.error);
            }
        };
    }

    //    需要从后端获取今日话题topic，今日话题时间time1，
    //讨论者黑白框中的头像imgurl，时间time，内容content，点赞数dianzhan，留言数liuyanshu，以及这是该讨论的第几条i
    // 以及这条讨论的回复头像imgurl2，内容content2,以及这是该留言的第几条a
    function dealContent(json) {
        var content = document.getElementById("content");
        var tlqbt = document.getElementsByClassName("tlqbt");
        var tlsj = document.getElementsByClassName("tlsj");
        tlqbt.innerText=json.topic;
        tlqbt.innerText=json.time1;

        for (var i = 0; i < json.mass.length; i++){
            content.appendChild(createActivity(json.mass[i].imgURL1, json.mass[i].time,json.mass[i].content, json.mass[i].dianzhan, json.mass[i].liuyanshu,i));//i为该话题的第几条
//            --------创建评论
            if(!liuyanshu){
                for (var i = 0; i < json.activity.length; i++)
                    content.appendChild(createActivity2(json.mass[i].imgURL2, json.mass[i].content2,json.mass[i].a));//a用来判断是否是最后一条评论，不是就显示
            }
            else{
                //显示发送框
             content.appendChild(createActivity3(json.mass[i].imgURL, json.mass[i].content,json.mass[i].a))
            }
        }
    }

//--------------------------主聊天函数------------------------
    function createActivity(imgURL, time,content, dianzhan, liuyanshu,i) {
        var div_0=document.createElement("div");
        var img = document.createElement("img");
        var span_1 = document.createElement("span");
        var span_2 = document.createElement("span");
        var div_1 = document.createElement("div");
        var i_1 = document.createElement("i");
        var span_3 = document.createElement("span");
        var i_2 = document.createElement("i");
        var span_4 = document.createElement("span");
        img.className ="tllogo";
        span_1.className="tlkxxsj";
        span_2.className="tlkxxnr";
        div.className = "tldzpl";
        i_1.className="fa fa-thumbs-up tltb";
        i_1.style = "color: #7e7e7e";
        span_3.className="tlsl heisez";
        i_2.className="fa fa-comment tltb";
        i_2.style = "color: #7e7e7e";
        span_4.className="tlsl heisez";
        img.src = imgURL;
        span_1.innerText = time;
        span_2.innerText = content;
        span_3.innerText = dianzhan;
        span_4.innerText = liuyanshu;
        div_0.id=i;

        div_1.appendChild(i_1);
        div_1.appendChild(span_3);
        div_1.appendChild(i_2);
        div_1.appendChild(span_4);
        div_0.appendChild(img);
        div_0.appendChild(span_1);
        div_0.appendChild(span_2);
        div_0.appendChild(div_1);


        return div_0;

    }
//    -----------------回复弹窗函数--------------------------------
    function createActivity2(imgURL, content,i) {
        var div_1=document.createElement("div");
        var img = document.createElement("img");
        var p_1 = document.createElement("span");
        var span_1 = document.createElement("span");

        div_1.className="tlhf zhongyang";
        img.className ="tlhfyuan";
        p_1.className="tlhfnr";
        span_1.className="tlxjpl";

        img.src = imgURL;
        p_1.innerText = content;
        span_1.innerText = "+";

        div_1.appendChild(img);
        div_1.appendChild(p_1);
        if(i){
            div_1.appendChild(span_1);
        }
        return div_1;
    }
    //    -----------------发送弹窗--------------------------------
    function createActivity3(imgURL) {
        var div_1 = document.createElement("div");
        var img = document.createElement("img");
        var textarea = document.createElement("textarea");
        var span_1 = document.createElement("span");

        div_1.className = "tlhf zhongyang";
        img.className = "tlhfyuan";
        textarea.className = "tlplkuang";
        textarea.type = "text";
        textarea.style = "color:#b8a4a4;";
        textarea.value = "来发第一条评论吧";
        textarea.onfocus = "if (value =='来发第一条评论吧'){value  =''}";
        textarea.onblur = "if (value  ==''){value='来发第一条评论吧'}";
        textarea.name = "usrname";
        img.src = imgURL;
        textarea.innerText = "来发第一条评论吧";
        span_1.innerText = "+";
        div_1.appendChild(img);
        div_1.appendChild(textarea);
        div_1.appendChild(span_1);
        return div_1;
    }
</script>
</body>
</html>