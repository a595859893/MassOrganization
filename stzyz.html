<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!--全屏显示-->
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">

    <!--引用weui框架做样式-->
    <link rel="stylesheet" href="http://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">

    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css">
    <style>

        a, button, div, input, select, textarea {
            -webkit-tap-highlight-color: transparent !important;
        }

        body {
            line-height: 1;
            background-color: #f9f9f9;
        }

        .profile-cover {
            position: relative;
            height: 11.25rem;
            background-repeat: no-repeat;
            background-position: 50%;
            background-size: cover;
            text-align: center;
        }

        .overlay {
            opacity: .7;
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }

        .mod-fil-img {
            padding-top: .625rem;
        }

        .m-avatar-box .m-img-box {
            border-radius: 50%;
            position: relative;
        }

        .mod-fil-img span {
            width: 4.375rem;
            height: 4.375rem;
            display: inline-block;
            padding: .25rem;
        }

        .mod-fil-img span img {
            width: 4.375rem;
            height: 4.375rem;
            border-radius: 50%;
        }

        .m-img-box img {
            vertical-align: top;
            object-fit: cover;
        }

        .mod-fil-name {
            padding: .625rem 0;
            font-size: 0;
        }

        .mod-fil-n {
            font-size: 0;
            margin-right: .3125rem;
        }

        .mod-fil-n .txt-shadow {
            font-size: 1.125rem;
            vertical-align: middle;
            margin-right: .3125rem;
        }

        .mod-fil-n span {
            display: inline-block;
        }

        .mod-fil-fans > div {
            position: relative;
            font-size: .75rem;
            color: black;
            display: inline-block;
        }

        .mod-fil-fans > div:last-child {
            padding-left: .625rem;
            margin-left: .625rem;
        }

        .mod-fil-fans span {
            font-family: Arial;
            margin-left: .3125rem;
        }

        .txt-shadow {
            color: black;
        }

        p {
            display: block;
            -webkit-margin-before: 1em;
            -webkit-margin-after: 1em;
            -webkit-margin-start: 0px;
            -webkit-margin-end: 0px;
        }

        .weui-panel.weui-panel_access {
            /*border-radius: 5%;*/
        }


    </style>


</head>
<body>

<header>
    <div class="profile-cover">
        <div class="overlay"></div>
        <div class="mod-fil-img m-avatar-box">
            <span class="m-img-box">
                <img id="mass_img" src="">
                <!--<i class="m-icon m-icon-goldv"></i>-->
            </span>
        </div>
        <div class="item-list" style="position: relative;">
            <div class="mod-fil-name m-txt-cut">
                <span class="mod-fil-n">
                    <span class="txt-shadow" id="mass_name">社团名字</span>
                    <!--<i class="m-icon m-icon-female"></i> -->
                </span>
                <!--<i class="m-icon m-icon-vipl6"></i>-->
            </div>

            <div class="txt-shadow">
                <i id="mass_num" class="fa fa-user-plus" onclick="color(event)"><span>0</span></i>
            </div>

        </div>
    </div>
</header>

<article>
    <!--社团招新栏-->
    <br>
    <div class="weui-panel weui-panel_access">
        <div class="weui-panel__hd">招新 &nbsp;</div>
        <div class="weui-panel__bd">
            <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                <div class="weui-media-box__hd">
                    <img class="" alt="">
                </div>
                <div class="weui-media-box__bd">
                    <h4 class="weui-media-box__title"> 标题一 &nbsp;<i class="fa fa-star" onclick="color(event)"></i><i
                            class="fa fa-calendar-plus-o" style="float: right;font-size: 20px;"></i></h4>
                    <p class="weui-media-box__desc">时间</p>
                    <p class="weui-media-box__desc">地点</p>
                    <p class="weui-media-box__desc">简介</p>
                </div>
            </a>
        </div>
    </div>


    <!--社团日志栏-card形式-->
    <br><br>
    <div id="mass_diary" class="weui-panel weui-panel_access">
        <div class="weui-panel__hd">社团日志 </div>
        <div class="weui-panel__bd">
            <!--js添加-->
        </div>
    </div>
</article>

<br>
<div class="weui-msg__extra-area" style="position:static">
    <div class="weui-footer">
        <!--<p class="weui-footer__links">-->
        <!--<a href="javascript:void(0);" class="weui-footer__link">底部链接文本</a>-->
        <!--</p>-->
        <p class="weui-footer__text">社团二维码</p>
    </div>
</div>




<script src="CommonJS.js"></script>
<script>
    var uid = getValue("uid");
    if (uid > -1)
        init();

    function color(event) {
        var content = {serverType: "mark", markUID: uid};
        var xmlhttp = GetXMLHTTPRequest();
        xmlhttp.open("POST", "mass.php", true);
        xmlhttp.setRequestHeader("CONTENT-TYPE", "application/x-www-form-urlencoded");
        xmlhttp.send(toStr(content));
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var json = JSON.parse(xmlhttp.responseText);
                if (json.success) {
                    var num = parseInt(document.getElementById("mass_num").innerHTML.replace("<span>", "").replace("</span>", ""));
                    num = json.mark ? num + 1 : num - 1;
                    event.target.innerHTML = " <span>" + num + " </span> ";
                    event.target.style.color = json.mark ? 'red' : '';
                } else
                    console.log(json.error);
            }
        }
    }

    function init() {
        var xmlhttp = GetXMLHTTPRequest();
        var content = {serverType: "getMass", UID: uid};
        xmlhttp.open("POST", "mass.php", true);
        xmlhttp.setRequestHeader("CONTENT-TYPE", "application/x-www-form-urlencoded");
        xmlhttp.send(toStr(content));
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
                var json = JSON.parse(xmlhttp.responseText);
                if (json.success) {
                    document.getElementById("mass_num").innerHTML = " <span>" + json.mass.number + " </span> ";
                    document.getElementById("mass_img").src = json.mass.logo;
                    document.getElementById("mass_name").innerText = json.mass.name;
                    document.getElementById("mass_num").style.color = json.mass.imark ? 'red' : '';
                    for (var i = 0; i < json.diary.length; i++) {
                        document.getElementById("mass_diary").appendChild(createDiary(json.diary[i].title, json.diary[i].content, json.diary[i].time,
                            json.diary[i].img, json.diary[i].logo, json.diary[i].UID));
                    }
                } else
                    console.log(json.error);
            }
        };

    }

    function createDiary(title, content, time, image, logo, uid) {
        var a = document.createElement("a");
        var div_1 = document.createElement("div");
        var div_2 = document.createElement("div");
        var logo_1 = document.createElement("img");
        var h4 = document.createElement("h4");
        var p_1= document.createElement("p");
        var p_2= document.createElement("p");
        var p_3= document.createElement("p");

        a.className = "weui-media-box weui-media-box_appmsg";
        div_1.className = "weui-panel__hd";
        logo_1.className = "weui-media-box__thumb";
        div_2.className = "weui-media-box__bd";
        h4.className = "weui-media-box__title";
        p_1.className=p_2.className=p_3.className = "weui-media-box__desc";

          h4.innerHTML = title + "<i class='fa fa-thumbs-o-up' style='float: right'> "+ 3 +"</i> ";
          p_1.innerText = time;
          p_2.innerText = content;
          div_1.style.paddingTop=0+'px';
          logo_1.src = logo;
          logo_1.style.width = 50+"px";

        for (var i = 0; i < image.length; i++){
            var img = document.createElement("img");
            img.style="background-image:url(" + image[i] + ")";
            p_3.appendChild(img);
        }

        div_1.appendChild(logo_1);
        div_2.appendChild(h4);
        div_2.appendChild(p_1);
        div_2.appendChild(p_2);
        div_2.appendChild(p_3);
        a.appendChild(div_1);
        a.appendChild(div_2);

        return a;
    }

</script>

</body>
</html>